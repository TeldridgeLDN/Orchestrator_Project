# Task ID: 30
# Title: Implement Project Removal Command
# Status: done
# Dependencies: 22, 26
# Priority: medium
# Description: Develop the remove command to deregister Claude projects
# Details:
Implemented the project removal command that deregisters Claude projects from the global registry. The implementation includes confirmation prompts and safety checks to prevent accidental removal.

```javascript
// lib/commands/remove.js
const readline = require('readline');
const { readConfig, writeConfig } = require('../utils/config');

async function removeProject(name, options) {
  try {
    // Get config
    const config = await readConfig();
    
    // Check if project exists
    if (!config.projects[name]) {
      throw new Error(`Project '${name}' not found.`);
    }
    
    // Get project details
    const project = config.projects[name];
    const isActive = name === config.active_project;
    
    // Show confirmation unless --force is used
    if (!options.force) {
      console.log(`About to remove project '${name}':`);
      console.log(`  Path: ${project.path}`);
      console.log(`  Created: ${new Date(project.created).toLocaleString()}`);
      console.log(`  Last active: ${new Date(project.last_active).toLocaleString()}`);
      
      if (isActive) {
        console.log('  WARNING: This is the currently active project!');
      }
      
      console.log();
      console.log('This will remove the project from the registry but NOT delete any files.');
      console.log();
      
      const confirmed = await confirmRemoval(name);
      if (!confirmed) {
        console.log('Removal cancelled.');
        return {
          success: false,
          cancelled: true
        };
      }
    }
    
    // Remove from registry
    delete config.projects[name];
    
    // If removed project was active, set active_project to null or most recent
    if (isActive) {
      const projectNames = Object.keys(config.projects);
      if (projectNames.length > 0) {
        // Find most recently active project
        let mostRecent = projectNames[0];
        let mostRecentTime = new Date(config.projects[mostRecent].last_active).getTime();
        
        for (const projectName of projectNames) {
          const lastActive = new Date(config.projects[projectName].last_active).getTime();
          if (lastActive > mostRecentTime) {
            mostRecent = projectName;
            mostRecentTime = lastActive;
          }
        }
        
        config.active_project = mostRecent;
      } else {
        config.active_project = null;
      }
    }
    
    // Write config
    await writeConfig(config);
    
    console.log(`Project '${name}' has been removed from the registry.`);
    
    if (isActive) {
      if (config.active_project) {
        console.log(`Active project is now '${config.active_project}'.`);
      } else {
        console.log('No active project set.');
      }
    }
    
    return {
      success: true,
      removed: name,
      newActive: config.active_project
    };
  } catch (error) {
    console.error(`Error removing project: ${error.message}`);
    return {
      success: false,
      error: error.message
    };
  }
}

async function confirmRemoval(name) {
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });
  
  return new Promise(resolve => {
    rl.question(`Type 'yes' to confirm removal of project '${name}': `, answer => {
      rl.close();
      resolve(answer.toLowerCase() === 'yes');
    });
  });
}

module.exports = { removeProject };
```

The implementation has been completed successfully with the following enhancements:

- Implemented full remove command at ~/.claude/lib/commands/remove.js
- Added confirmation prompt with readline interface (type 'yes' to confirm)
- Added --force flag to skip confirmation
- Handles non-existent projects with helpful error messages showing available projects
- Shows detailed project information before removal (path, created, last active, description, tags)
- Clears cache file if exists (/cache/.json)
- Intelligently handles active project removal by switching to most recently used project
- When last project is removed, sets active_project to null
- Never deletes project files (safety measure), only deregisters from config.json
- Uses formatting utilities for consistent output (formatISODate, formatTimeDifference)
- Atomic config updates using saveConfig function

# Test Strategy:
Test the remove command with both --force and interactive confirmation. Verify that the project is correctly removed from the registry and that the active project is updated if necessary. Test error cases such as non-existent projects. Verify that the confirmation prompt works correctly and that the command respects the user's response. Ensure that project files are not deleted, only the registry entry is removed.

All test scenarios have been executed and passed:
✅ Non-existent project error handling
✅ Non-active project removal with --force
✅ Cache file cleanup
✅ Cancelling removal (user types 'no')
✅ Active project removal with confirmation
✅ Automatic switch to most recent project
✅ Last project removal (sets active_project to null)
✅ Config validation after each operation

The command is production-ready and follows all patterns from existing commands.

# Subtasks:
## 1. Implement basic project removal functionality [done]
### Dependencies: None
### Description: Create the removeProject function that removes a project from the registry and handles the case when the active project is removed.
### Details:
Implemented the core functionality to remove projects from the config.json registry. Added logic to handle active project removal by switching to the most recently used project or setting active_project to null if no projects remain.

## 2. Add confirmation prompt and --force flag [done]
### Dependencies: 30.1
### Description: Implement an interactive confirmation prompt for project removal and add a --force flag to skip confirmation.
### Details:
Created the confirmRemoval function using the readline interface to prompt the user for confirmation. Added support for the --force flag to bypass the confirmation prompt for automated workflows.

## 3. Enhance error handling and user feedback [done]
### Dependencies: 30.1, 30.2
### Description: Improve error handling for non-existent projects and provide detailed project information before removal.
### Details:
Added comprehensive error handling for non-existent projects with helpful messages showing available projects. Enhanced the user interface to display detailed project information (path, created date, last active date, description, tags) before removal.

## 4. Implement cache cleanup and atomic config updates [done]
### Dependencies: 30.1
### Description: Add functionality to clear cache files when a project is removed and ensure atomic config updates.
### Details:
Implemented cache file cleanup for removed projects. Integrated with the saveConfig function to ensure atomic updates to the configuration file, preventing corruption during the removal process.

## 5. Add formatting utilities for consistent output [done]
### Dependencies: 30.3
### Description: Integrate formatting utilities for consistent date and time display in the command output.
### Details:
Added formatISODate and formatTimeDifference utilities to ensure consistent and user-friendly display of dates and times in the command output.

